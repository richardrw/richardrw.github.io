<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>把《Flask Web开发》读薄系列之第十章 用户资料 | Richard‘s Blog | 记录敲码过程中遇到的细节和问题</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Flask,读书笔记">
    <meta name="description" content="10.1 用户资料信息（个人基本资料）1. 在app/models.py中增加用户信息字段：123456789# ...class User(UserMixin, db.Model):    # ...    name = db.Column(db.String(64))    # 不同于username，可理解为昵称    location = db.Column(db.String(64))">
<meta name="keywords" content="Flask,读书笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="把《Flask Web开发》读薄系列之第十章 用户资料">
<meta property="og:url" content="https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/index.html">
<meta property="og:site_name" content="Richard‘s Blog">
<meta property="og:description" content="10.1 用户资料信息（个人基本资料）1. 在app/models.py中增加用户信息字段：123456789# ...class User(UserMixin, db.Model):    # ...    name = db.Column(db.String(64))    # 不同于username，可理解为昵称    location = db.Column(db.String(64))">
<meta property="og:updated_time" content="2017-12-30T11:08:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="把《Flask Web开发》读薄系列之第十章 用户资料">
<meta name="twitter:description" content="10.1 用户资料信息（个人基本资料）1. 在app/models.py中增加用户信息字段：123456789# ...class User(UserMixin, db.Model):    # ...    name = db.Column(db.String(64))    # 不同于username，可理解为昵称    location = db.Column(db.String(64))">
    
        <link rel="alternate" type="application/atom+xml" title="Richard‘s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/author.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Richard</h5>
          <a href="mailto:weichang321@gmail.com" title="weichang321@gmail.com" class="mail">weichang321@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/richardrw" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/6378627091" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">把《Flask Web开发》读薄系列之第十章 用户资料</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">把《Flask Web开发》读薄系列之第十章 用户资料</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-12-30T11:06:09.000Z" itemprop="datePublished" class="page-time">
  2017-12-30
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#10-1-用户资料信息（个人基本资料）"><span class="post-toc-number">1.</span> <span class="post-toc-text">10.1 用户资料信息（个人基本资料）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-在app-models-py中增加用户信息字段："><span class="post-toc-number">1.0.1.</span> <span class="post-toc-text">1. 在app/models.py中增加用户信息字段：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在app-models-py中增加刷新用户最后访问时间功能："><span class="post-toc-number">1.0.2.</span> <span class="post-toc-text">2. 在app/models.py中增加刷新用户最后访问时间功能：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在app-auth-views-py中更新已登录用户的最后访问时间："><span class="post-toc-number">1.0.3.</span> <span class="post-toc-text">3. 在app/auth/views.py中更新已登录用户的最后访问时间：</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#10-2-用户资料页面"><span class="post-toc-number">2.</span> <span class="post-toc-text">10.2 用户资料页面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-在app-main-views-py中定义用户资料页面路由："><span class="post-toc-number">2.0.1.</span> <span class="post-toc-text">1. 在app/main/views.py中定义用户资料页面路由：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在app-templates-user-html编写用户资料页面模板："><span class="post-toc-number">2.0.2.</span> <span class="post-toc-text">2. 在app/templates/user.html编写用户资料页面模板：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在app-templates-base-html导航条中添加一个链接访问用户自己的资料页面："><span class="post-toc-number">2.0.3.</span> <span class="post-toc-text">3. 在app/templates/base.html导航条中添加一个链接访问用户自己的资料页面：</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#10-3-用户资料编辑器"><span class="post-toc-number">3.</span> <span class="post-toc-text">10.3 用户资料编辑器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10-3-1-普通用户级别的资料编辑器"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">10.3.1 普通用户级别的资料编辑器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-在app-main-forms-py中添加普通用户用的资料编辑表单："><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">1. 在app/main/forms.py中添加普通用户用的资料编辑表单：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在app-main-views-py中定义普通用户进行资料编辑的路由："><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">2. 在app/main/views.py中定义普通用户进行资料编辑的路由：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在app-templates-user-html中添加普通用户用的编辑资料的链接："><span class="post-toc-number">3.1.3.</span> <span class="post-toc-text">3. 在app/templates/user.html中添加普通用户用的编辑资料的链接：</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#10-3-2-管理员级别的资料编辑器"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">10.3.2 管理员级别的资料编辑器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-在app-main-forms-py中添加管理员用的资料编辑表单："><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">1. 在app/main/forms.py中添加管理员用的资料编辑表单：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在app-main-views-py中定义管理员进行资料编辑的路由："><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">2. 在app/main/views.py中定义管理员进行资料编辑的路由：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在app-templates-user-html中添加管理员用的资料编辑链接："><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">3. 在app/templates/user.html中添加管理员用的资料编辑链接：</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#10-4-用户头像（使网站支持Gravatar提供的用户头像）"><span class="post-toc-number">4.</span> <span class="post-toc-text">10.4 用户头像（使网站支持Gravatar提供的用户头像）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-在app-models-py中增加avatar-hash字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法："><span class="post-toc-number">4.0.1.</span> <span class="post-toc-text">1. 在app/models.py中增加avatar_hash字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-在app-templates-user-html中增加资料页面中的头像显示："><span class="post-toc-number">4.0.2.</span> <span class="post-toc-text">2. 在app/templates/user.html中增加资料页面中的头像显示：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在-app-templates-base-html”中导航条上添加已登录用户的头像缩略图："><span class="post-toc-number">4.0.3.</span> <span class="post-toc-text">3. 在`app/templates/base.html”中导航条上添加已登录用户的头像缩略图：</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-把《Flask Web开发》读薄系列之第十章 用户资料"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">把《Flask Web开发》读薄系列之第十章 用户资料</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-12-30 19:06:09" datetime="2017-12-30T11:06:09.000Z"  itemprop="datePublished">2017-12-30</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="10-1-用户资料信息（个人基本资料）"><a href="#10-1-用户资料信息（个人基本资料）" class="headerlink" title="10.1 用户资料信息（个人基本资料）"></a>10.1 用户资料信息（个人基本资料）</h1><h3 id="1-在app-models-py中增加用户信息字段："><a href="#1-在app-models-py中增加用户信息字段：" class="headerlink" title="1. 在app/models.py中增加用户信息字段："></a>1. 在<code>app/models.py</code>中增加用户信息字段：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">class User(UserMixin, db.Model):</div><div class="line">    # ...</div><div class="line">    name = db.Column(db.String(64))    # 不同于username，可理解为昵称</div><div class="line">    location = db.Column(db.String(64))</div><div class="line">    about_me = db.Column(db.Text())</div><div class="line">    member_since = db.Column(db.DateTime(), default=datetime.utcnow())    # 注册时间</div><div class="line">    last_seen = db.Column(db.DateTime(), default=datetime.utcnow())    # 最后访问时间</div></pre></td></tr></table></figure>
<ul>
<li><code>db.String()</code>和<code>db.Text()</code>的区别是<code>db.Text()</code>不用指定最大长度。</li>
<li><code>db.Column()</code>中的<code>default</code>参数可以接受函数名作为默认值，所以<code>datetime.utcnow</code>后面没有<code>()</code>。</li>
</ul>
<h3 id="2-在app-models-py中增加刷新用户最后访问时间功能："><a href="#2-在app-models-py中增加刷新用户最后访问时间功能：" class="headerlink" title="2. 在app/models.py中增加刷新用户最后访问时间功能："></a>2. 在<code>app/models.py</code>中增加刷新用户最后访问时间功能：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">class User(UserMixin, db.Model):</div><div class="line">    # ...</div><div class="line">    </div><div class="line">    def ping(self):</div><div class="line">        self.last_seen = datenow.utcnow()</div><div class="line">        db.session.add(self)</div></pre></td></tr></table></figure>
<h3 id="3-在app-auth-views-py中更新已登录用户的最后访问时间："><a href="#3-在app-auth-views-py中更新已登录用户的最后访问时间：" class="headerlink" title="3. 在app/auth/views.py中更新已登录用户的最后访问时间："></a>3. 在<code>app/auth/views.py</code>中更新已登录用户的最后访问时间：</h3><p>用户每次访问网站后，<code>last_seen</code>字段都需要进行更新，在每次请求前进行更新，可以满足这个需求。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">@auth.before_app_request</div><div class="line">def before_request():</div><div class="line">    if current_user.is_authenticated:</div><div class="line">        current_user.ping()</div><div class="line">        if not current_user.confirmd \</div><div class="line">                and request.endpoint[:5] != &apos;auth.&apos; \</div><div class="line">                and request.endpoint != &apos;static&apos;:</div><div class="line">            return redirect(url_for(&apos;auth.unconfirmed&apos;))</div></pre></td></tr></table></figure>
<h1 id="10-2-用户资料页面"><a href="#10-2-用户资料页面" class="headerlink" title="10.2 用户资料页面"></a>10.2 用户资料页面</h1><h3 id="1-在app-main-views-py中定义用户资料页面路由："><a href="#1-在app-main-views-py中定义用户资料页面路由：" class="headerlink" title="1. 在app/main/views.py中定义用户资料页面路由："></a>1. 在<code>app/main/views.py</code>中定义用户资料页面路由：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">from flask import abort</div><div class="line"># ...</div><div class="line"></div><div class="line">@main.route(&apos;/user/&lt;username&gt;&apos;)</div><div class="line">def user(username):</div><div class="line">    user = User.query.filter_by(username=username).first()</div><div class="line">    if user is None:</div><div class="line">        abort(404)</div><div class="line">    return render_template(&apos;user.html&apos;, user=user)</div></pre></td></tr></table></figure>
<h3 id="2-在app-templates-user-html编写用户资料页面模板："><a href="#2-在app-templates-user-html编写用户资料页面模板：" class="headerlink" title="2. 在app/templates/user.html编写用户资料页面模板："></a>2. 在<code>app/templates/user.html</code>编写用户资料页面模板：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&#123;% extends &quot;base.html&quot; %&#125;</div><div class="line"></div><div class="line">&#123;% block title %&#125;Flasky - &#123;&#123; user.username &#125;&#125;&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% block page_content %&#125;</div><div class="line">&lt;div class=&quot;page-header&quot;&gt;</div><div class="line">    &lt;img class=&quot;img-rounded profile-thumbnail&quot; src=&quot;&#123;&#123; user.gravatar(size=256) &#125;&#125;&quot;&gt;</div><div class="line">    &lt;div class=&quot;profile-header&quot;&gt;</div><div class="line">        &lt;h1&gt;&#123;&#123; user.username &#125;&#125;&lt;/h1&gt;</div><div class="line">        &#123;% if user.name or user.location %&#125;</div><div class="line">        &lt;p&gt;</div><div class="line">            &#123;% if user.name %&#125;&#123;&#123; user.name &#125;&#125;&lt;br&gt;&#123;% endif %&#125;</div><div class="line">            &#123;% if user.location %&#125;</div><div class="line">                from &lt;a href=&quot;http://maps.google.com/?q=&#123;&#123; user.location &#125;&#125;&quot;&gt;&#123;&#123; user.location &#125;&#125;&lt;/a&gt;&lt;br&gt;</div><div class="line">            &#123;% endif %&#125;</div><div class="line">        &lt;/p&gt;</div><div class="line">        &#123;% endif %&#125;</div><div class="line">        &#123;% if current_user.is_administrator() %&#125;</div><div class="line">        &lt;p&gt;&lt;a href=&quot;mailto:&#123;&#123; user.email &#125;&#125;&quot;&gt;&#123;&#123; user.email &#125;&#125;&lt;/a&gt;&lt;/p&gt;</div><div class="line">        &#123;% endif %&#125;</div><div class="line">        &#123;% if user.about_me %&#125;&lt;p&gt;&#123;&#123; user.about_me &#125;&#125;&lt;/p&gt;&#123;% endif %&#125;</div><div class="line">        &lt;p&gt;</div><div class="line">            Member since &#123;&#123; moment(user.member_since).format(&apos;L&apos;) &#125;&#125;.</div><div class="line">            Last seen &#123;&#123; moment(user.last_seen).fromNow() &#125;&#125;.</div><div class="line">        &lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>
<h3 id="3-在app-templates-base-html导航条中添加一个链接访问用户自己的资料页面："><a href="#3-在app-templates-base-html导航条中添加一个链接访问用户自己的资料页面：" class="headerlink" title="3. 在app/templates/base.html导航条中添加一个链接访问用户自己的资料页面："></a>3. 在<code>app/templates/base.html</code>导航条中添加一个链接访问用户自己的资料页面：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% if current_user.is_authenticated %&#125;</div><div class="line">&lt;li&gt;</div><div class="line">    &lt;a href=&quot;&#123;&#123; url_for(&apos;main.user&apos;, username=current_user.username) &#125;&#125;&gt;</div><div class="line">        Profile</div><div class="line">    &lt;/a&gt;</div><div class="line">&lt;/li&gt;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<h1 id="10-3-用户资料编辑器"><a href="#10-3-用户资料编辑器" class="headerlink" title="10.3 用户资料编辑器"></a>10.3 用户资料编辑器</h1><p>用户资料编辑分两种情况：（1）用户自己进入一个页面编辑自己的资料。（2）管理员能够编辑任意用户的资料，不仅包括用户的个人信息，而且还包括普通用户不能直接访问的User模型的字段，如用户角色等。</p>
<h2 id="10-3-1-普通用户级别的资料编辑器"><a href="#10-3-1-普通用户级别的资料编辑器" class="headerlink" title="10.3.1 普通用户级别的资料编辑器"></a>10.3.1 普通用户级别的资料编辑器</h2><h3 id="1-在app-main-forms-py中添加普通用户用的资料编辑表单："><a href="#1-在app-main-forms-py中添加普通用户用的资料编辑表单：" class="headerlink" title="1. 在app/main/forms.py中添加普通用户用的资料编辑表单："></a>1. 在<code>app/main/forms.py</code>中添加普通用户用的资料编辑表单：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class EditProfileForm(FlaskForm):</div><div class="line">    name = StringField(&apos;Real name&apos;, validators=[Length(0, 64)])</div><div class="line">    location = StringField(&apos;Location&apos;, validators=[Length(0, 64)])</div><div class="line">    about_me = TextAreaField(&apos;About me&apos;)</div><div class="line">    submit = SubmitField(&apos;Submit&apos;)</div></pre></td></tr></table></figure>
<p><strong>注意</strong>：这个表单中所有字段都是<strong>可选的</strong>， 因此<strong>长度验证函数的长度允许为零</strong>。</p>
<h3 id="2-在app-main-views-py中定义普通用户进行资料编辑的路由："><a href="#2-在app-main-views-py中定义普通用户进行资料编辑的路由：" class="headerlink" title="2. 在app/main/views.py中定义普通用户进行资料编辑的路由："></a>2. 在<code>app/main/views.py</code>中定义普通用户进行资料编辑的路由：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">@main.route(&apos;/edit-profile&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])</div><div class="line">@login_required</div><div class="line">def edit_profile():</div><div class="line">    form = EditProfileForm()</div><div class="line">    if form.validate_on_submit():</div><div class="line">        current_user.name = form.name.data</div><div class="line">        current_user.location = form.location.data</div><div class="line">        current_user.about_me = form.about_me.data</div><div class="line">        db.session.add(current_user._get_current_object())</div><div class="line">        db.session.commit()</div><div class="line">        flash(&apos;Your profile has been updated.&apos;)</div><div class="line">        return redirect(url_for(&apos;main.user&apos;, username=current_user.username))</div><div class="line">    # 在显示表单前（渲染表单前），为表单所有字段设定初始值</div><div class="line">    form.name.data = current_user.name</div><div class="line">    form.location.data = current_user.location</div><div class="line">    form.about_me.data = current_user.about_me</div><div class="line">    return render_template(&apos;edit_profile.html&apos;, form=form)</div></pre></td></tr></table></figure>
<h3 id="3-在app-templates-user-html中添加普通用户用的编辑资料的链接："><a href="#3-在app-templates-user-html中添加普通用户用的编辑资料的链接：" class="headerlink" title="3. 在app/templates/user.html中添加普通用户用的编辑资料的链接："></a>3. 在<code>app/templates/user.html</code>中添加普通用户用的编辑资料的链接：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">&#123;% if user == current_user %&#125;</div><div class="line">&lt;a class=&quot;btn btn-default&quot; href=&quot;&#123;&#123; url_for(&apos;main.edit_profile&apos;) &#125;&#125;&quot;&gt;</div><div class="line">    Edit Profile</div><div class="line">&lt;/a&gt;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<p><strong>注意</strong>：链接外层的条件语句可以确保<strong>只有当用户查看自己的资料页面时</strong>才显示这个编辑个人资料的链接。</p>
<h2 id="10-3-2-管理员级别的资料编辑器"><a href="#10-3-2-管理员级别的资料编辑器" class="headerlink" title="10.3.2 管理员级别的资料编辑器"></a>10.3.2 管理员级别的资料编辑器</h2><h3 id="1-在app-main-forms-py中添加管理员用的资料编辑表单："><a href="#1-在app-main-forms-py中添加管理员用的资料编辑表单：" class="headerlink" title="1. 在app/main/forms.py中添加管理员用的资料编辑表单："></a>1. 在<code>app/main/forms.py</code>中添加管理员用的资料编辑表单：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">class EditProfileAdminForm(FlaskForm):</div><div class="line">    email = StringField(&apos;Email&apos;, validators=[DataRequired(), Length(1, 64),</div><div class="line">                        Email()])</div><div class="line">    username = StringField(&apos;Username&apos;, validators=[DataRequired(), Length(1, 64),</div><div class="line">                                                   Regexp(&apos;^[A-Za-z][A-Za-z0-9_.]*$&apos;, 0,</div><div class="line">                                                          &apos;Username must be have only &apos;</div><div class="line">                                                          &apos;letters, numbers, dots or&apos;</div><div class="line">                                                          &apos;underscores&apos;)])</div><div class="line">    confirmed = BooleanField(&apos;Confirmed&apos;)</div><div class="line">    role = SelectField(&apos;Role&apos;, coerce=int)</div><div class="line">    name = StringField(&apos;Real name&apos;, validators=[Length(0, 64)])</div><div class="line">    location = StringField(&apos;Location&apos;, validators=[Length(0, 64)])</div><div class="line">    about_me = TextAreaField(&apos;About me&apos;)</div><div class="line">    submit = SubmitField(&apos;Submit&apos;)</div><div class="line"></div><div class="line">    def __init__(self, user, *args, **kwargs):</div><div class="line">        super(EditProfileAdminForm, self).__init__(*args, **kwargs)</div><div class="line">        self.role.choices = [(role.id, role.name)</div><div class="line">                             for role in Role.query.order_by(Role.name).all()]</div><div class="line">        # 接受用户对象作为参数（成员变量）</div><div class="line">        self.user = user</div><div class="line"></div><div class="line">    def validate_email(self, field):</div><div class="line">        if field.data != self.user.email and \</div><div class="line">                User.query.filter_by(email=field.data).first():</div><div class="line">            raise ValidationError(&apos;Email already registered.&apos;)</div><div class="line"></div><div class="line">    def validate_username(self, field):</div><div class="line">        if field.data != self.user.username and \</div><div class="line">                User.query.filter_by(username=field.data).first():</div><div class="line">            raise ValidationError(&apos;Username already in use.&apos;)</div></pre></td></tr></table></figure>
<ul>
<li><code>SelectFiled()</code>可以实现下拉列表，可用它来选择用户角色。</li>
<li><code>SelectFiled</code>实例必须在其<code>choices</code>属性中设置可选选项，选项必须是由一个个元组组成的列表，各元组包含两个元素（选项的标识符和显示在控件中的文本字符串）。该例中，远足的标识符是角色的id，因为这个id是整数，所以添加<code>coerce=int</code>参数，从而把字段的值（字符串形式）转换为整数，从而保证这个字段的<code>data</code>属性值是整数。</li>
<li><code>email</code>和<code>username</code>都定义了自定义函数：验证这两个字段时，首先检查字段的值是否发生改变，如果发生改变，就要保证新值不和其他用户的相应字段重复；如果没有发生变化，则跳过该验证。</li>
</ul>
<h3 id="2-在app-main-views-py中定义管理员进行资料编辑的路由："><a href="#2-在app-main-views-py中定义管理员进行资料编辑的路由：" class="headerlink" title="2. 在app/main/views.py中定义管理员进行资料编辑的路由："></a>2. 在<code>app/main/views.py</code>中定义管理员进行资料编辑的路由：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">from app.decorators import admin_required</div><div class="line"># ...</div><div class="line"></div><div class="line">@main.route(&apos;/edit-profile/&lt;int:id&gt;&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])</div><div class="line">@login_required</div><div class="line">@admin_required</div><div class="line">def edit_profile_admin(id):</div><div class="line">    user = User.query.get_or_404(id)</div><div class="line">    form = EditProfileAdminForm(user=user)</div><div class="line">    if form.validate_on_submit():</div><div class="line">        user.email = form.email.data</div><div class="line">        user.username = form.username.data</div><div class="line">        user.confirmed = form.confirmed.data</div><div class="line">        user.role = Role.query.get(form.role.data)</div><div class="line">        user.name = form.name.data</div><div class="line">        user.location = form.location.data</div><div class="line">        user.about_me = form.about_me.data</div><div class="line">        db.session.add(user)</div><div class="line">        db.session.commit()</div><div class="line">        flash(&apos;The profile has been updated.&apos;)</div><div class="line">        return redirect(url_for(&apos;.user&apos;, username=user.username))</div><div class="line">    # 在显示表单前（渲染表单前），为表单所有字段设定初始值</div><div class="line">    form.email.data = user.email</div><div class="line">    form.username.data = user.username</div><div class="line">    form.confirmed.data = user.confirmed</div><div class="line">    # 将user.role_id赋值给表单字段</div><div class="line">    form.role.data = user.role_id</div><div class="line">    form.name.data = user.name</div><div class="line">    form.location.data = user.location</div><div class="line">    form.about_me.data = user.about_me</div><div class="line">    return render_template(&apos;edit_profile.html&apos;, form=form, user=user)</div></pre></td></tr></table></figure>
<ul>
<li>该例中，要进行编辑的用户由<code>id</code>指定，因此可以使用Flask-SQLAlchemy提供的<code>get_or_404()</code>函数，如果提供的<code>id</code>不正确，则返回<code>404</code>错误。</li>
<li>将<code>user.role_id</code>赋值给<code>form.role.data</code>是因为步骤1中<code>choices</code>属性设置的元组列表使用数字标识符表示各选项。</li>
<li>提交表单后，角色<code>id</code>从<code>form.role.data</code>中获取，并通过<code>Role.query.get()</code>方法加载角色对象。</li>
</ul>
<h3 id="3-在app-templates-user-html中添加管理员用的资料编辑链接："><a href="#3-在app-templates-user-html中添加管理员用的资料编辑链接：" class="headerlink" title="3. 在app/templates/user.html中添加管理员用的资料编辑链接："></a>3. 在<code>app/templates/user.html</code>中添加管理员用的资料编辑链接：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">&#123;% if current_user.is_administrator() %&#125;</div><div class="line">&lt;a class=&quot;btn btn-danger&quot; href=&quot;&#123;&#123; url_for(&apos;main.edit_proflie_admin&apos;, id=user.id) &#125;&#125;&gt;</div><div class="line">    Edit Profile [Admin]</div><div class="line">&lt;/a&gt;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure>
<h1 id="10-4-用户头像（使网站支持Gravatar提供的用户头像）"><a href="#10-4-用户头像（使网站支持Gravatar提供的用户头像）" class="headerlink" title="10.4 用户头像（使网站支持Gravatar提供的用户头像）"></a>10.4 用户头像（使网站支持Gravatar提供的用户头像）</h1><p>Gravatar可以把头像和电子邮件地址关联起来，使得你在支持Gravatar服务的网站中只需要头像URL就能显示你的头像（网站没有头像功能也能显示用户头像，只要网站支持Gravatar）。</p>
<p>头像URL由<code>https://secure.gravatar.com/avatar/</code>+<code>电子邮件地址的MD5散列值</code>组成。在浏览器地址栏输入该URL就会看到某电子邮件对应的头像（前提是到<code>http://gravatar.com</code>中注册账户并上传头像），如果没有对应的头像，则会显示一个默认图片。</p>
<p>头像URL的查询字符串可以包含多个参数，以此配置头像图片的特征（如像素大小等），可设参数如表10-1所示：<br>表10-1 Gravatar查询字符串参数</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td>图片大小，单位是像素</td>
</tr>
<tr>
<td>r</td>
<td>图片级别（有没有暴力倾向等）。可选值有<code>&#39;g&#39;</code>、<code>&#39;pg&#39;</code>、<code>&#39;r&#39;</code>和<code>&#39;x&#39;</code></td>
</tr>
<tr>
<td>d</td>
<td>没有注册Gravatar服务的用户使用默认图片生成方式。可选值有：(1)<code>&#39;404&#39;</code>，返回404错误；(2)默认图片的URL；(3)图片生成器：<code>&#39;mm&#39;</code>、<code>&#39;identicon&#39;</code>、<code>&#39;monsterid&#39;</code>、<code>&#39;wavatar&#39;</code>、<code>&#39;retro&#39;</code>或<code>&#39;blank&#39;</code>之一</td>
</tr>
<tr>
<td>fd</td>
<td>强制使用默认头像</td>
</tr>
</tbody>
</table>
<h3 id="1-在app-models-py中增加avatar-hash字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法："><a href="#1-在app-models-py中增加avatar-hash字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法：" class="headerlink" title="1. 在app/models.py中增加avatar_hash字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法："></a>1. 在<code>app/models.py</code>中增加<code>avatar_hash</code>字段（用于存储邮箱地址的MD5散列值）、生成邮箱地址的MD5三散列值方法、生成头像URL方法：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">import hashlib</div><div class="line"># ...</div><div class="line"></div><div class="line">class User(UserMixin, db.Model):</div><div class="line">    # ...</div><div class="line">    avatar_hash = db.Column(db.String(32))</div><div class="line">    </div><div class="line">    def __init__(self, **kwargs):</div><div class="line">        super(User, self).__init__(**kwargs)</div><div class="line">        if self.role is None:</div><div class="line">            if self.email == current_app.config[&apos;FLASKY_ADMIN&apos;]:</div><div class="line">                self.role = Role.query.filter_by(name=&apos;Administrator&apos;).first()</div><div class="line">            if self.role is None:</div><div class="line">                self.role = Role.query.filter_by(default=True).first()</div><div class="line">        if self.email is not None and self.avatar_hash is None:</div><div class="line">            self.avatar_hash = self.gravatar_hash()</div><div class="line">            </div><div class="line">    # 定义生成邮箱地址MD5散列值的方法</div><div class="line">    def gravatar_hash(self):</div><div class="line">        return hashlib.md5(self.emial.lower().encode(&apos;utf-8&apos;)).hexdigest()</div><div class="line">        </div><div class="line">    # 定义生成头像URL的方法</div><div class="line">    def gravatar(self, size=100, default=&apos;identicon&apos;, rating=&apos;g&apos;):</div><div class="line">        url = &apos;https://secure.gravatar.com/avatar&apos;</div><div class="line">        hash = self.gravatar_hash()</div><div class="line">        return &apos;&#123;url&#125;/&#123;hash&#125;?s=&#123;size&#125;&amp;d=&#123;default&#125;&amp;r=&#123;rating&#125;&apos;.format(</div><div class="line">            url=url, hash=hash, size=size, default=default, rating=rating)</div></pre></td></tr></table></figure>
<p><strong>注意</strong>：由于生成MD5值是一项CPU密集型操作，所以要在某个页面中生成大量头像，计算量会很大。考虑到电子邮件地址的MD5散列值是不变的（电子邮件地址不变前提下），因此可以将MD5值存储到User模型字段中，而不必每次都进行计算，从而得到优化。</p>
<h3 id="2-在app-templates-user-html中增加资料页面中的头像显示："><a href="#2-在app-templates-user-html中增加资料页面中的头像显示：" class="headerlink" title="2. 在app/templates/user.html中增加资料页面中的头像显示："></a>2. 在<code>app/templates/user.html</code>中增加资料页面中的头像显示：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">&lt;img class=&quot;img-rounded profile-thumbnail&quot; src=&quot;&#123;&#123; user.gravatar(size=256) &#125;&#125;&quot;&gt;</div></pre></td></tr></table></figure>
<h3 id="3-在-app-templates-base-html”中导航条上添加已登录用户的头像缩略图："><a href="#3-在-app-templates-base-html”中导航条上添加已登录用户的头像缩略图：" class="headerlink" title="3. 在`app/templates/base.html”中导航条上添加已登录用户的头像缩略图："></a>3. 在`app/templates/base.html”中导航条上添加已登录用户的头像缩略图：</h3><p>为了更好地调整页面中头像图片的显示格式，可自定义CSS类，将其放在<code>statics</code>文件夹中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># ...</div><div class="line"></div><div class="line">&#123;% block head %&#125;</div><div class="line">&#123;&#123; super() &#125;&#125;</div><div class="line"># ...</div><div class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#123;&#123; url_for(&apos;static&apos;, filename=&apos;styles.css&apos;) &#125;&#125;&quot;&gt;</div><div class="line">&#123;% endblock %&#125;</div><div class="line"></div><div class="line">&#123;% blcok navbar %&#125;</div><div class="line"># ...</div><div class="line"></div><div class="line">&lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;</div><div class="line">                &#123;% if current_user.is_authenticated %&#125;</div><div class="line">                &lt;li class=&quot;dropdown&quot;&gt;</div><div class="line">                    &lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot;&gt;</div><div class="line">                        &lt;img src=&quot;&#123;&#123; current_user.gravatar(size=18) &#125;&#125;&quot;&gt;</div><div class="line">                        Account &lt;b class=&quot;caret&quot;&gt;&lt;/b&gt;</div><div class="line">                    &lt;/a&gt;</div><div class="line"># ...</div><div class="line">&#123;% endblock %&#125;</div></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2017-12-30T11:08:08.000Z" itemprop="dateUpdated">2017-12-30 19:08:08</time>
</span><br>


        
        文章链接<a href="/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/" target="_blank" rel="external">https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/</a>
        
    </div>
    <footer>
        <a href="https://richardrw.github.io">
            <img src="/img/author.jpg" alt="Richard">
            Richard
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flask/">Flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&title=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&pic=https://richardrw.github.io/img/author.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&title=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&source=the day with Python 爱生活，爱体验，工作认真，生活随意" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&via=https://richardrw.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/12/30/把《Flask Web开发》读薄系列之第十一章 博客文章/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">把《Flask Web开发》读薄系列之第十一章 博客文章</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/12/30/把《Flask Web开发》读薄系列之第九章 用户角色/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">把《Flask Web开发》读薄系列之第九章 用户角色</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'true';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>













</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        支持作者写出更好的文章
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/zhifubao.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Richard &copy; 2015 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&title=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&pic=https://richardrw.github.io/img/author.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&title=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&source=the day with Python 爱生活，爱体验，工作认真，生活随意" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《把《Flask Web开发》读薄系列之第十章 用户资料》 — Richard‘s Blog&url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/&via=https://richardrw.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://richardrw.github.io/2017/12/30/把《Flask Web开发》读薄系列之第十章 用户资料/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADOUlEQVR42u3aQY7bMBAEwP3/p51LDgE2kruHMmBRpZPhyBaLBtLLmfn5ia/XP9fv949eH91/1aeO7r/swsbGxr4J+3V6nT8mYfx+3b6Tb1NiwcbGxt6VffQ//PnD2vCIFhSs5PxnOP8GbGxsbOw22PKQS7YpeR8bGxsbu11cvtzkyHHVQQgbGxv7aez2T/yVQn9eckoaBh+vpWFjY2N/PTsPpO9//ZH+NjY2NvYXs1/llTRo2/vbQtLK+v9+AzY2NvZG7DwA8kJ/cgBYOR7khaQ3T8TGxsbegt0CZjGWxFVelrpgGAgbGxt7I/Z6azY/WszaA3mAtQ0GbGxs7J3YsyGY2bjPrPXb/iTRz4ONjY29NbstKq2MTtZJW2764Z3Y2NjY27HzBkAeMPk9eZthFqh1FQobGxv7VuxZC3a9hbC+nsu2AxsbG/u27Hy8pgXnzeP1AlPdKsbGxsZ+GHtWVMqj6BVf7bHn8CfExsbG3po9K/G0Az2zbcpbv8PGADY2NvbN2bNHJoWe9sgx2+LiWdjY2NibspOPzVoF7SDOtSEXtQewsbGxb8vO/3xfKeskEbUSS7P7sbGxsfdgrxT9P7fQPHjy49BlvQ5sbGzsL2O3obI+iJlvx+x1caTBxsbG3o7dlu9XGgkrR51kc6OVYGNjY2/BnoVW/ql2g/IGQF6K+s/92NjY2Nux68QbRU5eElof4oxqadjY2NhbsGdF9mQp+dbM4m0WmdjY2Nh7s1fCrG3org/6tCH3ZnAHGxsb++bsdkxnZaAn2ejzlGljbDi4g42NjX0rdlRSL0v2eVzlxalZXNW/MzY2NvbN2Sslntk3XNt4qCeVsLGxsbdmz8r07eFkpUncbhk2Njb2M9mzJebFoPNjT96ESO7HxsbG3o/9Kq8kPJKif94SmAVVsQfY2NjYN2fPAqBtA68cY/JmcH0UwcbGxt6IPWvQtuWn2QEj+Z5ZUxkbGxt7P3YeDHnYXDsA1G5oNLKDjY2N/Uh2Tpotrt2yYXxiY2NjP5idh0Te+m0Z+Ua/KSphY2Njb8TOm7tt+Sb/1zzSVjYLGxsbez/2rHA/K+63Y0ArXevL+tvY2NjY38v+A/mZaQTChtu7AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '前往理查德生活记录';
            clearTimeout(titleTime);
        } else {
            document.title = '理查德生活记录';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
